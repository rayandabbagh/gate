<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gate - AI Agent Team</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --primary-light: #3b82f6;
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            background-attachment: fixed;
            color: var(--gray-900);
            line-height: 1.6;
            min-height: 100vh;
            font-size: 14px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #2563eb 100%);
            color: white;
            padding: 2.5rem 0;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.15), 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }
        
        .header-content {
            position: relative;
            z-index: 1;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .logo-text h1 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
            letter-spacing: -0.5px;
        }

        .logo-text p {
            font-size: 0.875rem;
            opacity: 0.9;
            font-weight: 400;
        }

        .header-badge {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            padding: 0.625rem 1.25rem;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.75px;
            box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--gray-200);
        }

        .tab {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 0.9375rem;
            font-weight: 600;
            color: var(--gray-600);
            transition: all 0.2s;
            margin-bottom: -2px;
            letter-spacing: -0.2px;
        }

        .tab:hover {
            color: var(--primary);
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        /* Form Section */
        .form-section {
            background: white;
            border-radius: 12px;
            padding: 2.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.08), 0 2px 4px -1px rgba(0, 0, 0, 0.04);
            margin-bottom: 2rem;
            border: 1px solid var(--gray-200);
            transition: box-shadow 0.3s ease;
        }
        
        .form-section:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .form-section h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--gray-900);
            letter-spacing: -0.3px;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.75rem;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1.5px solid var(--gray-300);
            border-radius: 6px;
            font-size: 0.9375rem;
            transition: all 0.2s;
            background: white;
            font-family: inherit;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .input-hint {
            font-size: 0.75rem;
            color: var(--gray-500);
            margin-top: 0.375rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 1rem 2.5rem;
            font-size: 0.9375rem;
            font-weight: 700;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.4), 0 2px 4px -1px rgba(37, 99, 235, 0.2);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            letter-spacing: -0.2px;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-primary:hover:not(:disabled)::before {
            left: 100%;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 12px -2px rgba(37, 99, 235, 0.5), 0 4px 6px -1px rgba(37, 99, 235, 0.3);
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary) 100%);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 1.5px solid var(--primary);
            padding: 0.75rem 1.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }

        /* Loading */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-overlay.show {
            display: flex;
        }

        .loading-card {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
            min-width: 300px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .spinner {
            border: 3px solid var(--gray-200);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Codebase Context Card */
        .codebase-context {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            border: 1px solid var(--gray-200);
            max-width: 100%;
            overflow: hidden;
        }

        .codebase-context h3 {
            font-size: 1.125rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--gray-900);
            letter-spacing: -0.2px;
        }

        .context-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
            max-width: 100%;
        }

        .context-item {
            padding: 1rem;
            background: var(--gray-50);
            border-radius: 6px;
            border-left: 3px solid var(--primary);
        }

        .context-item-label {
            font-size: 0.75rem;
            color: var(--gray-500);
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 0.25rem;
            letter-spacing: 0.5px;
        }

        .context-item-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--gray-900);
        }

        .context-item-description {
            font-size: 0.8125rem;
            color: var(--gray-600);
            margin-top: 0.25rem;
        }

        /* Agents Grid */
        .agents-section {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            border: 1px solid var(--gray-200);
        }

        .agents-section h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--gray-900);
            letter-spacing: -0.3px;
        }

        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        .agent-card {
            background: white;
            border: 1.5px solid var(--gray-200);
            border-radius: 10px;
            padding: 1.75rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .agent-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 12px -2px rgba(0, 0, 0, 0.1), 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .agent-card.running {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.02);
        }

        .agent-card.completed {
            border-color: var(--success);
            background: rgba(5, 150, 105, 0.02);
        }

        .agent-card.failed {
            border-color: var(--danger);
            background: rgba(220, 38, 38, 0.02);
        }

        .agent-card h3 {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--gray-900);
            letter-spacing: -0.2px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .agent-info-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-left: 0.5rem;
            line-height: 1;
            font-style: normal;
            flex-shrink: 0;
        }
        
        .agent-info-icon:hover {
            background: var(--primary-dark);
            transform: scale(1.15);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.25);
        }

        /* Modal Overlay - centered popup */
        .agent-info-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            animation: fadeIn 0.2s ease;
        }
        
        .agent-info-modal-overlay.show {
            display: flex;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        .agent-info-modal {
            background: white;
            border-radius: 12px;
            padding: 0;
            box-shadow: 0 20px 50px -10px rgba(0, 0, 0, 0.3), 0 10px 20px -5px rgba(0, 0, 0, 0.15);
            max-width: 500px;
            width: 100%;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.3s ease;
            overflow: hidden;
            position: relative;
            margin: auto;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .agent-info-modal-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
        }
        
        .agent-info-modal-header h3 {
            margin: 0;
            font-size: 1rem;
            font-weight: 700;
            letter-spacing: -0.2px;
        }
        
        .agent-info-modal-close {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
            line-height: 1;
            padding: 0;
        }
        
        .agent-info-modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .agent-info-modal-body {
            padding: 1.5rem;
            font-size: 0.875rem;
            color: var(--gray-700);
            line-height: 1.6;
        }
        
        .agent-info-modal-body p {
            margin: 0;
            line-height: 1.6;
        }

        .agent-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            background: var(--gray-200);
            color: var(--gray-700);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .agent-status.running {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary);
        }

        .agent-status.completed {
            background: rgba(5, 150, 105, 0.1);
            color: var(--success);
        }

        .agent-status.failed {
            background: rgba(220, 38, 38, 0.1);
            color: var(--danger);
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: var(--gray-200);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            transition: width 0.3s;
            width: 0%;
            border-radius: 3px;
        }

        .agent-metrics {
            margin-top: 1rem;
            font-size: 0.8125rem;
            color: var(--gray-600);
        }

        .agent-details-toggle {
            margin-top: 1rem;
            padding: 0.75rem;
            background: white;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            color: var(--gray-700);
            width: 100%;
            text-align: left;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s;
            font-weight: 500;
        }

        .agent-details-toggle:hover {
            background: var(--gray-100);
            border-color: var(--primary);
        }

        .agent-details {
            margin-top: 1rem;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .agent-card.expanded .agent-details {
            max-height: 600px;
            overflow-y: auto;
        }

        .agent-logs {
            margin-top: 1rem;
            font-size: 0.8125rem;
        }

        .log-entry {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 6px;
            border-left: 3px solid var(--gray-300);
            background: var(--gray-50);
            font-size: 0.8125rem;
        }

        .log-entry.success {
            border-left-color: var(--success);
            background: rgba(5, 150, 105, 0.05);
        }

        .log-entry.warning {
            border-left-color: var(--warning);
            background: rgba(217, 119, 6, 0.05);
        }

        .log-entry.error {
            border-left-color: var(--danger);
            background: rgba(220, 38, 38, 0.05);
        }

        .log-entry.info {
            border-left-color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }

        .log-timestamp {
            font-size: 0.75rem;
            color: var(--gray-500);
            margin-right: 0.5rem;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .log-message {
            color: var(--gray-700);
        }

        .reasoning-section {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(37, 99, 235, 0.03);
            border-radius: 6px;
            border-left: 3px solid var(--primary);
        }

        .reasoning-section h4 {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .reasoning-item {
            font-size: 0.8125rem;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
            padding-left: 1rem;
            position: relative;
            line-height: 1.5;
        }

        .reasoning-item:before {
            content: "•";
            position: absolute;
            left: 0;
            color: var(--primary);
            font-weight: bold;
        }

        /* Results */
        .results-section {
            display: none;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }

        .summary-card {
            background: white;
            border-radius: 12px;
            padding: 2.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.08), 0 2px 4px -1px rgba(0, 0, 0, 0.04);
            margin-bottom: 2rem;
            border-left: 5px solid var(--primary);
            border: 1px solid var(--gray-200);
            transition: all 0.3s ease;
        }

        .summary-card.safe {
            border-left-color: var(--success);
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.04) 0%, rgba(5, 150, 105, 0.01) 100%);
        }
        
        .summary-card.bugs-found {
            border-left-color: var(--danger);
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.04) 0%, rgba(220, 38, 38, 0.01) 100%);
            animation: pulse-warning 2s ease-in-out infinite;
        }
        
        @keyframes pulse-warning {
            0%, 100% { border-left-color: var(--danger); }
            50% { border-left-color: var(--warning); }
        }

        .summary-card h3 {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--gray-900);
            letter-spacing: -0.3px;
        }

        .findings-count {
            font-size: 4rem;
            font-weight: 800;
            color: var(--primary);
            margin: 1rem 0;
            line-height: 1;
            letter-spacing: -2px;
        }

        .summary-card.safe .findings-count {
            color: var(--success);
        }

        /* Debug Bundle Section */
        .debug-bundle-section {
            background: white;
            border-radius: 12px;
            padding: 2.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.08), 0 2px 4px -1px rgba(0, 0, 0, 0.04);
            margin-bottom: 2rem;
            border: 1px solid var(--gray-200);
            transition: box-shadow 0.3s ease;
        }
        
        .debug-bundle-section:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .debug-bundle-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .debug-bundle-header h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-900);
            letter-spacing: -0.3px;
        }

        .debug-bundle-description {
            background: rgba(37, 99, 235, 0.03);
            border-left: 3px solid var(--primary);
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            font-size: 0.875rem;
            color: var(--gray-700);
            line-height: 1.6;
        }

        .debug-bundle {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #e5e5e5;
            padding: 2rem;
            border-radius: 8px;
            font-family: 'SF Mono', 'Monaco', 'Menlo', 'Courier New', monospace;
            font-size: 0.8125rem;
            overflow-x: auto;
            max-height: 800px;
            overflow-y: auto;
            position: relative;
            border: 1px solid #404040;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
            line-height: 1.7;
        }

        .copy-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 600;
            transition: all 0.2s;
            z-index: 10;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .copy-button:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .copy-button.copied {
            background: var(--success);
        }

        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            margin: 0;
            line-height: 1.6;
        }

        .error-alert {
            background: rgba(220, 38, 38, 0.1);
            border: 2px solid var(--danger);
            border-radius: 8px;
            padding: 1rem;
            color: var(--danger);
            margin-bottom: 2rem;
            display: none;
            line-height: 1.6;
        }

        .error-alert.show {
            display: block;
        }

        .info-box {
            background: rgba(37, 99, 235, 0.03);
            border-left: 3px solid var(--primary);
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1.5rem;
            font-size: 0.875rem;
            color: var(--gray-700);
        }

        .github-preview {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: 6px;
            padding: 1rem;
            margin-top: 0.5rem;
            font-size: 0.875rem;
        }

        .github-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }

        .github-link:hover {
            text-decoration: underline;
        }

        .agent-scope {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(37, 99, 235, 0.03);
            border-radius: 6px;
            font-size: 0.8125rem;
        }

        .agent-scope-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.75rem;
        }

        .scope-item {
            color: var(--gray-700);
            margin-bottom: 0.25rem;
            padding-left: 1rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .agents-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">G</div>
                    <div class="logo-text">
                    <h1>Gate</h1>
                    <p>AI Agent Team That Stops Production Bugs Before They Reach Your Users</p>
                </div>
            </div>
            <div class="header-badge">Production Ready</div>
        </div>
    </div>

    <div class="container">
        <div class="tabs">
            <button class="tab active" data-tab="analyze">Analyze Repository</button>
            <button class="tab" data-tab="agents">Agents</button>
            <button class="tab" data-tab="results">Results</button>
        </div>

        <div id="analyzeTab" class="tab-content active">
            <div class="form-section">
                <h2>Repository Analysis</h2>
                
                <div class="info-box">
                    <strong>How It Works:</strong> Each commit is analyzed by a team of specialized AI agents. Agents read commit diffs, understand changes in full codebase context, and autonomously generate tests/simulations/checks to proof-test the commit before production. When bugs are found (even micro bugs), a comprehensive Debug Bundle is generated with all context needed to fix issues.
                </div>

                <div class="info-box" style="background: rgba(251, 191, 36, 0.1); border-left-color: #f59e0b; margin-bottom: 1.5rem;">
                    <strong>View Previous Results:</strong> If you have an existing analysis ID (e.g., from a previous session), paste it below to view results without re-running the analysis.
                    <div style="margin-top: 0.75rem; display: flex; gap: 0.5rem;">
                        <input type="text" id="viewAnalysisId" placeholder="analysis_20251123_205429" 
                               style="flex: 1; padding: 0.5rem; border: 1px solid var(--gray-300); border-radius: 4px; font-family: monospace; font-size: 0.875rem;">
                        <button type="button" class="btn-secondary" onclick="viewExistingResults()" 
                                style="padding: 0.5rem 1rem; white-space: nowrap;">
                            View Results
                        </button>
                    </div>
                </div>

                <form id="analyzeForm">
                    <div class="input-group">
                        <label for="sourceType">Source Type</label>
                        <select id="sourceType" name="sourceType">
                            <option value="local">Local Repository</option>
                            <option value="github">GitHub Repository</option>
                        </select>
                    </div>

                    <div class="input-group" id="localPathGroup">
                        <label for="repoPath">Local Repository Path</label>
                        <input type="text" id="repoPath" name="repoPath" 
                               placeholder="/path/to/your/repository">
                        <div class="input-hint">Enter the absolute path to your local repository</div>
                    </div>

                    <div class="input-group" id="githubUrlGroup" style="display: none;">
                        <label for="githubUrl">GitHub Repository URL</label>
                        <input type="text" id="githubUrl" name="githubUrl" 
                               placeholder="https://github.com/username/repo">
                        <div class="input-hint">Paste the GitHub repository URL</div>
                        <div id="githubPreview" class="github-preview" style="display: none;"></div>
                    </div>

                    <div class="input-group">
                        <label for="commitSha">Commit SHA <span style="color: var(--danger);">*</span></label>
                        <input type="text" id="commitSha" name="commitSha" required
                               placeholder="90a131fe55cf7143caf9c8fd0c0dcfc87233b723">
                        <div class="input-hint">REQUIRED: The specific commit to analyze for production bugs. This is what we're checking to see if it's safe before it reaches users.</div>
                    </div>

                    <div class="input-group">
                        <label for="branch">Branch</label>
                        <input type="text" id="branch" name="branch" 
                               value="main">
                        <div class="input-hint">Branch to analyze (default: main)</div>
                    </div>

                    <button type="submit" class="btn-primary" id="analyzeBtn">
                        <span>Start Analysis</span>
                    </button>
                </form>
            </div>

            <div class="codebase-context" id="codebaseContext" style="display: none;">
                <h3>Codebase Analysis</h3>
                <p style="color: var(--gray-600); margin-bottom: 1.5rem; font-size: 0.875rem;">
                    Repository structure analyzed. This shows the codebase that was passed as input - agents use this full context to understand dependencies and relationships when analyzing the commit for production bugs.
                </p>
                <div class="context-grid" id="contextGrid"></div>
            </div>
        </div>

        <div id="agentsTab" class="tab-content" style="display: none;">
            <div class="agents-section" id="agentsSection">
                <h2>Agent Team Status</h2>
                <p style="color: var(--gray-600); margin-bottom: 1.5rem; font-size: 0.875rem;">
                    Each agent analyzes this commit against the entire codebase using LLM intelligence. Click "View What This Agent Did" to see detailed reasoning, logs, and findings.
                </p>
                <div class="agents-grid" id="agentsGrid">
                    <div style="padding: 3rem; text-align: center; color: var(--gray-500);">
                        <h3 style="margin-bottom: 1rem; font-weight: 600;">No Agents Running Yet</h3>
                        <p>Start an analysis from the "Analyze Repository" tab to see agent execution details.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="resultsTab" class="tab-content" style="display: none;">
            <div class="results-section" id="resultsSection" style="display: none;">
                <div class="summary-card" id="summaryCard" style="display: none;">
                    <h3>Analysis Summary</h3>
                    <div id="commitInfo" style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 1rem; font-family: monospace;"></div>
                    <div class="findings-count" id="findingsCount">0</div>
                    <p id="summaryText" style="color: var(--gray-600);">No issues found.</p>
                </div>

                <div class="debug-bundle-section" id="debugBundleSection" style="display: none;">
                    <div class="debug-bundle-header">
                        <h3>Debug Bundle</h3>
                        <button class="btn-secondary" id="copyBundleBtn" onclick="copyDebugBundle()">
                            Copy for Cursor - Fix Bugs
                        </button>
                    </div>
                    <div class="debug-bundle-description" id="debugBundleDescription" style="display: none;">
                        <!-- Removed verbose descriptions - only show the bundle itself -->
                    </div>
                    <div class="debug-bundle">
                        <button class="copy-button" onclick="copyDebugBundle()">Copy</button>
                        <pre id="debugBundleContent"></pre>
                    </div>
                </div>
            </div>
            <div id="noResultsMessage" style="padding: 3rem; text-align: center; color: var(--gray-500);">
                <h3 style="margin-bottom: 1rem; font-weight: 600;">No Analysis Results Yet</h3>
                <p>Start an analysis from the "Analyze Repository" tab to see results here.</p>
            </div>
        </div>

        <div id="errorSection" class="error-alert"></div>
    </div>
    
    <!-- Agent Info Modal -->
    <div id="agentInfoModalOverlay" class="agent-info-modal-overlay" onclick="hideAgentInfo()">
        <div class="agent-info-modal" onclick="event.stopPropagation()">
            <div class="agent-info-modal-header">
                <h3 id="agentInfoModalTitle"></h3>
                <button class="agent-info-modal-close" onclick="hideAgentInfo()" aria-label="Close">×</button>
            </div>
            <div class="agent-info-modal-body" id="agentInfoModalBody"></div>
        </div>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-card">
            <div class="spinner"></div>
            <h3 style="margin-bottom: 0.5rem; font-weight: 600;">Analyzing Repository</h3>
            <p style="color: var(--gray-600); font-size: 0.875rem;">The AI agent team is working...</p>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        
        let currentAnalysisId = null;
        let statusCheckInterval = null;
        let codebaseInfo = null;

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => {
                t.classList.remove('active');
                if (t.dataset.tab === tabName) {
                    t.classList.add('active');
                }
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
                content.style.display = 'none';
            });
            
            const activeTabContent = document.getElementById(`${tabName}Tab`);
            if (activeTabContent) {
                activeTabContent.classList.add('active');
                activeTabContent.style.display = 'block';
            }
        }
        
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                switchTab(tab.dataset.tab);
            });
        });

        // Source type switching
        document.getElementById('sourceType').addEventListener('change', (e) => {
            const isGitHub = e.target.value === 'github';
            document.getElementById('localPathGroup').style.display = isGitHub ? 'none' : 'block';
            document.getElementById('githubUrlGroup').style.display = isGitHub ? 'block' : 'none';
            
            document.getElementById('repoPath').value = '';
            document.getElementById('githubUrl').value = '';
            document.getElementById('githubPreview').style.display = 'none';
        });

        // Auto-detect GitHub URLs in local path field
        document.getElementById('repoPath').addEventListener('input', (e) => {
            const path = e.target.value.trim();
            
            if (path.match(/github\.com\//)) {
                document.getElementById('sourceType').value = 'github';
                document.getElementById('sourceType').dispatchEvent(new Event('change'));
                document.getElementById('githubUrl').value = path;
                document.getElementById('repoPath').value = '';
                
                const preview = document.getElementById('githubPreview');
                const match = path.match(/github\.com\/([^\/]+)\/([^\/]+)/);
                if (match) {
                    const [, owner, repo] = match;
                    preview.innerHTML = `
                        <strong>Repository:</strong> <a href="${path}" target="_blank" class="github-link">${owner}/${repo}</a>
                        <div style="margin-top: 0.5rem; color: var(--success); font-size: 0.75rem;">
                            Auto-detected GitHub repository
                        </div>
                    `;
                    preview.style.display = 'block';
                }
            }
        });
        
        // GitHub URL parsing
        document.getElementById('githubUrl').addEventListener('input', (e) => {
            const url = e.target.value.trim();
            const preview = document.getElementById('githubPreview');
            
            if (url) {
                const match = url.match(/github\.com\/([^\/]+)\/([^\/]+)/);
                if (match) {
                    const [, owner, repo] = match;
                    preview.innerHTML = `
                        <strong>Repository:</strong> <a href="${url}" target="_blank" class="github-link">${owner}/${repo}</a>
                    `;
                    preview.style.display = 'block';
                } else {
                    preview.style.display = 'none';
                }
            } else {
                preview.style.display = 'none';
            }
        });

        // Form submission
        document.getElementById('analyzeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const sourceType = document.getElementById('sourceType').value;
            let repoPath = document.getElementById('repoPath').value.trim();
            let githubUrl = document.getElementById('githubUrl').value.trim();
            const commitSha = document.getElementById('commitSha').value.trim();
            const branch = document.getElementById('branch').value.trim();
            
            // Validate commit SHA is provided
            if (!commitSha || commitSha.length < 7) {
                showError('Commit SHA is REQUIRED. Please provide a valid commit SHA to analyze. This is what we\'re checking to see if it\'s production-safe before it reaches users.');
                return;
            }
            
            // Validate commit SHA format (should be hex characters)
            if (!/^[0-9a-fA-F]{7,40}$/.test(commitSha)) {
                showError('Invalid commit SHA format. Please provide a valid git commit SHA (7-40 hexadecimal characters).');
                return;
            }

            if (sourceType === 'local' && repoPath && repoPath.match(/github\.com\//)) {
                githubUrl = repoPath;
                repoPath = '';
                document.getElementById('sourceType').value = 'github';
                document.getElementById('sourceType').dispatchEvent(new Event('change'));
                document.getElementById('githubUrl').value = githubUrl;
                document.getElementById('repoPath').value = '';
            }

            if (sourceType === 'local' && !repoPath) {
                showError('Please enter a local repository path (e.g., /path/to/repo) or switch to GitHub Repository mode');
                return;
            }
            if (sourceType === 'local' && repoPath && (repoPath.startsWith('http') || repoPath.match(/github\.com\//))) {
                showError('This looks like a GitHub URL. Please select "GitHub Repository" as the source type, or enter a local file path.');
                return;
            }
            if (sourceType === 'github' && !githubUrl) {
                showError('Please enter a GitHub repository URL (e.g., https://github.com/username/repo)');
                return;
            }

            document.getElementById('loadingOverlay').classList.add('show');
            document.getElementById('errorSection').classList.remove('show');
            document.getElementById('codebaseContext').style.display = 'none';
            
            const resultsSection = document.getElementById('resultsSection');
            if (resultsSection) {
                resultsSection.style.display = 'none';
            }
            
            document.getElementById('analyzeBtn').disabled = true;

            try {
                try {
                    await fetch(`${API_BASE}/`);
                } catch (err) {
                    throw new Error('Cannot connect to backend API. Make sure the server is running on http://localhost:8000');
                }

                const payload = {
                    source_type: sourceType,
                    branch: branch || 'main'
                };

                if (sourceType === 'local') {
                    payload.repo_path = repoPath;
                } else {
                    payload.github_url = githubUrl;
                }

                if (commitSha) {
                    payload.commit_sha = commitSha;
                }

                const response = await fetch(`${API_BASE}/analyze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.detail || 'Analysis failed');
                }

                currentAnalysisId = data.analysis_id;
                document.getElementById('loadingOverlay').classList.remove('show');
                document.getElementById('codebaseContext').style.display = 'block';
                switchTab('agents'); // Switch to agents tab to show progress
                
                startStatusPolling();
                
            } catch (error) {
                showError(error.message);
                document.getElementById('loadingOverlay').classList.remove('show');
                document.getElementById('analyzeBtn').disabled = false;
            }
        });

        function startStatusPolling() {
            if (statusCheckInterval) {
                clearInterval(statusCheckInterval);
            }

            checkStatus();
            statusCheckInterval = setInterval(checkStatus, 2000);
        }

        async function checkStatus() {
            if (!currentAnalysisId) return;

            try {
                const response = await fetch(`${API_BASE}/status/${currentAnalysisId}`);
                const status = await response.json();

                updateCodebaseContext(status);
                updateAgentCards(status.agents || []);

                // Check if all agents completed OR if overall status is completed
                const allCompleted = status.agents.length >= 4 && status.agents.every(a => a.status === 'completed' || a.status === 'failed');
                const overallCompleted = status.status === 'completed';
                
                if ((allCompleted || overallCompleted) && statusCheckInterval) {
                    clearInterval(statusCheckInterval);
                    statusCheckInterval = null;
                    fetchResults();
                } else if (allCompleted || overallCompleted) {
                    // If interval was cleared but agents are done, fetch results anyway
                    fetchResults();
                }
            } catch (error) {
                console.error('Error checking status:', error);
            }
        }

        function updateCodebaseContext(status) {
            const grid = document.getElementById('contextGrid');
            const codebaseContext = status.codebase_context || {};
            
            // Only show repository-level analysis (codebase structure)
            // NOT agent execution metrics (those go in agent cards)
            const totalFiles = codebaseContext.total_files || 0;
            const routes = codebaseContext.routes || [];
            const testFiles = codebaseContext.test_files || [];
            const filesByType = codebaseContext.files_by_extension || {};
            
            // Get application type from codebase context or detect from structure
            let appType = codebaseContext.app_type || 'unknown';
            if (!appType || appType === 'unknown') {
                // Try to detect from file types
                if (filesByType['.tsx'] || filesByType['.jsx']) {
                    appType = 'web';
                } else if (filesByType['.py'] && (routes.length > 0 || filesByType['.py'] > 10)) {
                    appType = 'api';
                } else if (filesByType['.js'] && routes.length > 0) {
                    appType = 'api';
                } else {
                    appType = 'unknown';
                }
            }
            
            // Count files by type - filesByType contains arrays of file paths, so get length
            const getCount = (ext) => {
                const files = filesByType[ext];
                return Array.isArray(files) ? files.length : (typeof files === 'number' ? files : 0);
            };
            const jsFiles = getCount('.js') + getCount('.jsx');
            const tsFiles = getCount('.ts') + getCount('.tsx');
            const pyFiles = getCount('.py');
            
            grid.innerHTML = `
                <div class="context-item">
                    <div class="context-item-label">Total Files</div>
                    <div class="context-item-value">${totalFiles}</div>
                    <div class="context-item-description">Files in repository</div>
                </div>
                <div class="context-item">
                    <div class="context-item-label">Application Type</div>
                    <div class="context-item-value">${appType.toUpperCase()}</div>
                    <div class="context-item-description">Detected from structure</div>
                </div>
                <div class="context-item">
                    <div class="context-item-label">API Routes</div>
                    <div class="context-item-value">${routes.length}</div>
                    <div class="context-item-description">Endpoints found</div>
                </div>
                <div class="context-item">
                    <div class="context-item-label">JavaScript/TypeScript</div>
                    <div class="context-item-value">${jsFiles + tsFiles}</div>
                    <div class="context-item-description">JS/TS files</div>
                </div>
                <div class="context-item">
                    <div class="context-item-label">Python Files</div>
                    <div class="context-item-value">${pyFiles}</div>
                    <div class="context-item-description">Python files</div>
                </div>
                <div class="context-item">
                    <div class="context-item-label">Test Files</div>
                    <div class="context-item-value">${testFiles.length || 0}</div>
                    <div class="context-item-description">Existing test coverage</div>
                </div>
            `;
        }

        function updateAgentCards(agents) {
            const grid = document.getElementById('agentsGrid');
            
            const agentNames = [
                'Regression Agent',
                'Test Generation Agent',
                'E2E Simulation Agent',
                'Shadow Comparison Agent'
            ];

            grid.innerHTML = '';

            agentNames.forEach(name => {
                const agent = agents.find(a => a.agent_name === name) || {
                    agent_name: name,
                    status: 'pending',
                    progress: 0,
                    logs: [],
                    reasoning: [],
                    findings: [],
                    metrics: {}
                };

                const card = document.createElement('div');
                card.className = `agent-card ${agent.status}`;
                
                // Only show FAILED (red) if agent actually failed with an error
                // If agent completed successfully with 0 bugs, that's SUCCESS (green)
                const hasErrors = agent.logs && agent.logs.some(log => log.level === 'error');
                const statusClass = agent.status === 'completed' ? 'completed' : 
                                   (agent.status === 'failed' || hasErrors) ? 'failed' : 'running';
                
                const hasLogs = agent.logs && agent.logs.length > 0;
                const hasReasoning = agent.reasoning && agent.reasoning.length > 0;
                const hasDetails = hasLogs || hasReasoning || (agent.findings && agent.findings.length > 0);
                
                let scopeInfo = '';
                // Show agent-specific execution metrics (what this agent did)
                const agentMetrics = [];
                
                // Test Generation Agent metrics
                if (agent.agent_name === 'Test Generation Agent') {
                    if (agent.metrics?.tests_generated) {
                        agentMetrics.push(`Generated ${agent.metrics.tests_generated} test suites`);
                    }
                    if (agent.metrics?.tests_executed !== undefined) {
                        agentMetrics.push(`Executed ${agent.metrics.tests_executed} tests`);
                    }
                    if (agent.metrics?.tests_passed !== undefined && agent.metrics?.tests_failed !== undefined) {
                        agentMetrics.push(`${agent.metrics.tests_passed} passed, ${agent.metrics.tests_failed} failed`);
                    }
                }
                
                // E2E Simulation Agent metrics
                if (agent.agent_name === 'E2E Simulation Agent') {
                    if (agent.metrics?.flows_generated) {
                        agentMetrics.push(`Generated ${agent.metrics.flows_generated} flows`);
                    }
                    if (agent.metrics?.flows_executed !== undefined) {
                        agentMetrics.push(`Executed ${agent.metrics.flows_executed} flows`);
                    }
                    if (agent.metrics?.flows_passed !== undefined && agent.metrics?.flows_failed !== undefined) {
                        agentMetrics.push(`${agent.metrics.flows_passed} passed, ${agent.metrics.flows_failed} failed`);
                    }
                }
                
                // Shadow Comparison Agent metrics
                if (agent.agent_name === 'Shadow Comparison Agent') {
                    if (agent.metrics?.endpoints_compared) {
                        agentMetrics.push(`Compared ${agent.metrics.endpoints_compared} endpoints`);
                    }
                    if (agent.metrics?.discrepancies_found !== undefined) {
                        agentMetrics.push(`${agent.metrics.discrepancies_found} discrepancies found`);
                    }
                }
                
                // Regression Agent metrics
                if (agent.agent_name === 'Regression Agent' && agent.metrics?.total_files) {
                    agentMetrics.push(`Analyzed ${agent.metrics.total_files} files`);
                    if (agent.metrics.files_by_type) {
                        const topTypes = Object.entries(agent.metrics.files_by_type)
                            .slice(0, 3)
                            .map(([type, count]) => `${count} ${type.replace('.', '')}`)
                            .join(', ');
                        if (topTypes) {
                            agentMetrics.push(`File types: ${topTypes}`);
                        }
                    }
                }
                
                if (agentMetrics.length > 0) {
                    scopeInfo = `
                        <div class="agent-scope">
                            <div class="agent-scope-title">Agent Execution Metrics</div>
                            ${agentMetrics.map(metric => `<div class="scope-item">${metric}</div>`).join('')}
                        </div>
                    `;
                }
                
                // ONLY count CRITICAL bugs (severity="high") - these are the ones we flag
                const criticalFindings = agent.findings ? agent.findings.filter(f => f.severity === 'high') : [];
                const criticalCount = criticalFindings.length;
                // Status message: Only show FAILED if there are actual errors
                // If completed with 0 bugs, show success message
                const statusMessage = agent.status === 'completed' 
                    ? (criticalCount === 0 ? 'COMPLETED - NO PRODUCTION BUGS' : `COMPLETED - ${criticalCount} PRODUCTION BUG${criticalCount !== 1 ? 'S' : ''} FOUND`)
                    : (agent.status === 'failed' || hasErrors)
                    ? 'FAILED - CHECK ERRORS'
                    : agent.status === 'running'
                    ? 'ANALYZING'
                    : agent.status.toUpperCase();
                
                // Agent descriptions for info popups - short 2-line explanations
                const agentDescriptions = {
                    'Regression Agent': 'Analyzes commit diffs in full codebase context to detect risky logic changes, missing error handling, and dependency issues that could break production.\n\nUses LLM intelligence to understand code relationships and predict failures before they reach users.',
                    'Test Generation Agent': 'Autonomously generates and executes unit/integration tests for each changed code path in the commit.\n\nTest failures are flagged as potential production bugs, ensuring code changes are thoroughly proof-tested before deployment.',
                    'E2E Simulation Agent': 'Simulates real user workflows using browser automation - clicks buttons, fills forms, navigates pages, and tests complete user journeys.\n\nCatches breakages that only appear when the system is fully assembled, identifying UI/UX failures and broken flows.',
                    'Shadow Comparison Agent': 'Runs actual shadow traffic by comparing the current commit against the last good version side-by-side.\n\nDetects behavioral differences in responses, latency, schemas, and error rates that could break production integrations.'
                };
                
                const agentDescription = agentDescriptions[name] || '';
                
                // Escape description for onclick - convert newlines to HTML breaks
                let escapedDescription = '';
                if (agentDescription) {
                    escapedDescription = agentDescription
                        .replace(/\\/g, '\\\\')
                        .replace(/'/g, "\\'")
                        .replace(/"/g, '&quot;')
                        .replace(/\n/g, '<br>');
                }
                
                const agentTitle = agentDescription ? 
                    agentDescription.replace(/\n/g, ' ').substring(0, 100) + '...' : 
                    `Click to see what ${agent.agent_name} tests for`;
                
                card.innerHTML = `
                    <h3 style="display: flex; align-items: center; gap: 0.5rem;">
                        ${agent.agent_name}
                        ${agentDescription ? `<span class="agent-info-icon" title="${agentTitle}" onclick="showAgentInfo('${name}', \`${agentDescription.replace(/`/g, '\\`')}\`)">ⓘ</span>` : ''}
                    </h3>
                    <div class="agent-status ${statusClass}">
                        <span class="status-dot"></span>
                        <span>${statusMessage}</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${(agent.progress || 0) * 100}%"></div>
                    </div>
                    ${agent.summary ? `<div class="agent-metrics" style="font-size: 0.8125rem; color: var(--gray-600); margin-top: 0.5rem; line-height: 1.4;">${agent.summary}</div>` : ''}
                    ${scopeInfo}
                    ${hasDetails ? `
                        <button class="agent-details-toggle" onclick="toggleAgentDetails(this)">
                            <span>View What This Agent Did</span>
                            <span>▼</span>
                        </button>
                        <div class="agent-details">
                            ${hasReasoning ? `
                                <div class="reasoning-section">
                                    <h4>Analysis Reasoning</h4>
                                    <p style="font-size: 0.8125rem; color: var(--gray-600); margin-bottom: 0.75rem;">What this agent analyzed and why:</p>
                                    ${agent.reasoning.map(r => `<div class="reasoning-item">${r.replace(/^Reasoning:\s*/i, '')}</div>`).join('')}
                                </div>
                            ` : ''}
                            ${hasLogs ? `
                                <div class="agent-logs">
                                    <h4 style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--gray-900);">Execution Logs</h4>
                                    <p style="font-size: 0.8125rem; color: var(--gray-600); margin-bottom: 0.75rem;">Step-by-step execution details:</p>
                                    ${agent.logs.slice(-20).map(log => {
                                        const message = (log.message || '').replace(/^[^\w]*/g, '').trim(); // Remove leading non-word chars (emojis)
                                        const level = log.level || 'info';
                                        const levelLabel = level === 'warning' ? 'WARNING' : level === 'error' ? 'ERROR' : level === 'success' ? 'SUCCESS' : 'INFO';
                                        return `
                                            <div class="log-entry ${level}">
                                                <span class="log-level">${levelLabel}</span>
                                                <span class="log-timestamp">${log.timestamp ? new Date(log.timestamp).toLocaleTimeString() : ''}</span>
                                                <span class="log-message">${message}</span>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            ` : ''}
                            ${criticalFindings && criticalFindings.length > 0 ? `
                                <div style="margin-top: 1rem;">
                                    <h4 style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--gray-900);">CRITICAL Bugs Found</h4>
                                    <p style="font-size: 0.8125rem; color: var(--gray-600); margin-bottom: 0.75rem;">Only showing CRITICAL bugs that will cause production failures:</p>
                                    ${criticalFindings.slice(0, 10).map(f => `
                                        <div style="padding: 0.75rem; margin-bottom: 0.5rem; background: #fff3cd; border-radius: 6px; border-left: 3px solid var(--danger);">
                                            <div style="font-weight: 600; font-size: 0.8125rem; color: var(--gray-900); margin-bottom: 0.25rem;">
                                                [CRITICAL] ${f.description || 'Unknown bug'}
                                            </div>
                                            ${f.file || f.endpoint ? `<div style="font-size: 0.75rem; color: var(--gray-600); font-family: monospace; margin-bottom: 0.25rem;">Where: ${f.file || f.endpoint || 'unknown'}</div>` : ''}
                                            ${f.type ? `<div style="font-size: 0.75rem; color: var(--gray-500); margin-bottom: 0.25rem;">Type: ${f.type.replace(/_/g, ' ')}</div>` : ''}
                                        </div>
                                    `).join('')}
                                    ${criticalFindings.length > 10 ? `<div style="font-size: 0.75rem; color: var(--gray-500);">+ ${criticalFindings.length - 10} more critical bugs found</div>` : ''}
                                    ${agent.findings && agent.findings.length > criticalFindings.length ? `
                                        <div style="font-size: 0.75rem; color: var(--gray-500); margin-top: 0.5rem; font-style: italic;">
                                            Note: ${agent.findings.length - criticalFindings.length} non-critical finding(s) not shown (only critical bugs are flagged)
                                        </div>
                                    ` : ''}
                                </div>
                            ` : ''}
                            ${agent.findings && agent.findings.length === 0 && agent.status === 'completed' && !hasErrors ? `
                                <div style="margin-top: 1rem; padding: 0.75rem; background: #d4edda; border-radius: 6px; border-left: 3px solid var(--success);">
                                    <div style="font-weight: 600; font-size: 0.8125rem; color: #155724;">No issues found</div>
                                    <div style="font-size: 0.75rem; color: #155724; margin-top: 0.25rem;">This agent analyzed the commit and found no production bugs.</div>
                                </div>
                            ` : ''}
                            ${(agent.status === 'failed' || hasErrors) ? `
                                <div style="margin-top: 1rem; padding: 0.75rem; background: #f8d7da; border-radius: 6px; border-left: 3px solid var(--danger);">
                                    <div style="font-weight: 600; font-size: 0.8125rem; color: #721c24;">Agent Execution Error</div>
                                    <div style="font-size: 0.75rem; color: #721c24; margin-top: 0.25rem;">This agent encountered an error and could not complete its analysis. Check the execution logs above for details.</div>
                                </div>
                            ` : ''}
                        </div>
                    ` : ''}
                `;
                
                grid.appendChild(card);
            });
        }

        function toggleAgentDetails(button) {
            const card = button.closest('.agent-card');
            const isExpanded = card.classList.contains('expanded');
            
            if (isExpanded) {
                card.classList.remove('expanded');
                button.querySelector('span:first-child').textContent = 'View What This Agent Did';
                button.querySelector('span:last-child').textContent = '▼';
            } else {
                card.classList.add('expanded');
                button.querySelector('span:first-child').textContent = 'Hide Details';
                button.querySelector('span:last-child').textContent = '▲';
            }
        }

        async function viewExistingResults() {
            const analysisId = document.getElementById('viewAnalysisId').value.trim();
            if (!analysisId) {
                showError('Please enter an analysis ID (e.g., analysis_20251123_205429)');
                return;
            }
            
            currentAnalysisId = analysisId;
            document.getElementById('loadingOverlay').classList.add('show');
            document.getElementById('errorSection').classList.remove('show');
            
            try {
                // First check if analysis exists
                const statusResponse = await fetch(`${API_BASE}/status/${analysisId}`);
                const status = await statusResponse.json();
                
                if (status.status === 'not_found') {
                    throw new Error(`Analysis ID "${analysisId}" not found. Make sure the analysis ID is correct and the backend server is still running.`);
                }
                
                // If exists, fetch results and display
                await fetchResults();
            } catch (error) {
                showError(error.message || 'Error loading analysis results. Make sure the analysis ID is correct and the backend server is running.');
                document.getElementById('loadingOverlay').classList.remove('show');
                currentAnalysisId = null;
            }
        }

        async function fetchResults() {
            if (!currentAnalysisId) return;

            try {
                const response = await fetch(`${API_BASE}/results/${currentAnalysisId}`);
                const results = await response.json();

                displayResults(results);
                document.getElementById('analyzeBtn').disabled = false;
                document.getElementById('loadingOverlay').classList.remove('show');
            } catch (error) {
                showError('Error fetching results: ' + error.message);
                document.getElementById('loadingOverlay').classList.remove('show');
            }
        }

        function displayResults(results) {
            switchTab('results');
            
            setTimeout(() => {
                const resultsSection = document.getElementById('resultsSection');
                const summaryCard = document.getElementById('summaryCard');
                const debugBundleSection = document.getElementById('debugBundleSection');
                const debugBundleDescription = document.getElementById('debugBundleDescription');
                const noResultsMessage = document.getElementById('noResultsMessage');

                if (noResultsMessage) {
                    noResultsMessage.style.display = 'none';
                }

                resultsSection.style.display = 'block';
                summaryCard.style.display = 'block';

                // Show commit info
                const commitSha = results.debug_bundle?.commit_sha || results.commit_sha || '';
                const commitInfo = document.getElementById('commitInfo');
                if (commitSha) {
                    const commitShort = commitSha.length > 8 ? commitSha.substring(0, 8) : commitSha;
                    commitInfo.textContent = `Commit: ${commitShort} | Analyzed this commit in full codebase context for production bugs`;
                    commitInfo.style.display = 'block';
                } else {
                    commitInfo.textContent = `Analyzing this commit for production bugs`;
                    commitInfo.style.display = 'block';
                }

                // Only show URGENT bugs in results (critical/high severity)
                const issuesFound = results.issues_found || 0;
                const criticalCount = results.critical_count || 0;
                
                document.getElementById('findingsCount').textContent = criticalCount;  // Only show urgent bugs
                
                // Update summary to reflect commit-focused analysis - ONLY urgent bugs
                let summaryText = results.summary || 'Analysis complete.';
                if (criticalCount === 0) {
                    summaryText = 'This commit was analyzed for production bugs. No urgent bugs detected - appears safe for production.';
                } else {
                    summaryText = `This commit might introduce ${criticalCount} urgent bug(s) that WILL cause production failures. See details below.`;
                }
                document.getElementById('summaryText').textContent = summaryText;

                // Only show Debug Bundle if there are urgent bugs
                if (criticalCount === 0) {
                    summaryCard.classList.add('safe');
                    summaryCard.classList.remove('bugs-found');
                    
                    // Hide debug bundle section - no bugs, no bundle needed
                    debugBundleSection.style.display = 'none';
                    debugBundleDescription.innerHTML = `
                        <strong>Release Safe:</strong> This commit was analyzed for potential production bugs and none were found. 
                        No debug bundle generated (only generated when urgent bugs are found that need to be fixed).
                    `;
                } else {
                    // Show debug bundle - there are urgent bugs to fix
                    summaryCard.classList.remove('safe');
                    summaryCard.classList.add('bugs-found');
                    
                    // Hide description - only show the bundle itself
                    debugBundleDescription.style.display = 'none';
                    debugBundleSection.style.display = 'block';
                    
                    // Format and display debug bundle - this is the ONLY thing shown
                    if (results.debug_bundle) {
                        const bundle = results.debug_bundle;
                        if (results.codebase_context && !bundle.codebase_context) {
                            bundle.codebase_context = results.codebase_context;
                        }
                        // Ensure diffs are included in bundle
                        if (results.commit_diffs && !bundle.commit_changes?.diffs) {
                            if (!bundle.commit_changes) bundle.commit_changes = {};
                            bundle.commit_changes.diffs = results.commit_diffs;
                        }
                        if (results.full_diff && !bundle.full_diff) {
                            bundle.full_diff = results.full_diff;
                        }
                        const formattedBundle = formatDebugBundleForAgent(bundle, results);
                        
                        document.getElementById('debugBundleContent').textContent = formattedBundle;
                        
                        const copyBtn = document.getElementById('copyBundleBtn');
                        copyBtn.textContent = 'Copy for Cursor - Fix Bugs';
                    }
                }
            }, 100);
        }

        function formatDebugBundleFromResults(results) {
            return {
                analysis_id: results.analysis_id,
                summary: results.summary,
                issues_found: results.issues_found,
                agents: results.agents || []
            };
        }

        function formatDebugBundleForAgent(bundle, results) {
            // Ultra-concise format optimized for coding agents (Cursor, Claude, etc.)
            // This bundle is copy-pasted directly into the agent that wrote the initial code
            // It must immediately understand: what changed + what's broken + how to fix it
            const commitSha = bundle.commit_sha || results.commit_sha || 'unknown';
            const commitShort = commitSha.length > 8 ? commitSha.substring(0, 8) : commitSha;
            const commitChanges = bundle.commit_changes || {};
            const issues = bundle.issues || {};
            const criticalIssues = issues.critical || [];
            
            let formatted = ``;
            
            // Header - context for the coding agent
            formatted += `# Gate Debug Bundle - Commit ${commitShort}\n`;
            formatted += `This commit introduces critical bugs that must be fixed before production.\n\n`;
            
            // Part 1: WHAT CHANGED (the actual commit diff - this is what was pushed)
            formatted += `## WHAT CHANGED\n`;
            formatted += `The following code was pushed in this commit:\n\n`;
            
            if (commitChanges.diffs && commitChanges.diffs.length > 0) {
                // Show actual diff - this is what changed
                for (const diffEntry of commitChanges.diffs) {
                    formatted += `### ${diffEntry.file}\n`;
                    formatted += `\`\`\`diff\n`;
                    formatted += `${diffEntry.diff}\n`;
                    formatted += `\`\`\`\n\n`;
                }
            } else if (bundle.full_diff) {
                // Fallback to full unified diff
                formatted += `\`\`\`diff\n`;
                formatted += `${bundle.full_diff}\n`;
                formatted += `\`\`\`\n\n`;
            } else {
                formatted += `WARNING: No diff available. This may be an empty or merge commit.\n\n`;
            }
            
            // Part 2: WHAT'S BROKEN (bugs found)
            if (criticalIssues.length > 0) {
                formatted += `## WHAT'S BROKEN\n`;
                formatted += `The code above introduces the following critical bugs that WILL affect production:\n\n`;
                
                if (bundle.production_bugs) {
                    // Use concise format if available
                    formatted += `${bundle.production_bugs}\n\n`;
                } else {
                    // Fallback: generate concise bug list with context
                    criticalIssues.forEach((finding, idx) => {
                        formatted += `### Bug #${idx + 1}: ${finding.type || 'Unknown'}\n`;
                        formatted += `**Location:** ${finding.file || finding.endpoint || finding.flow || 'unknown'}\n`;
                        formatted += `**Problem:** ${finding.description || 'Unknown bug'}\n`;
                        
                        // Add context if available
                        if (finding.reasoning && finding.reasoning.length > 0) {
                            const reasons = Array.isArray(finding.reasoning) ? finding.reasoning : [finding.reasoning];
                            formatted += `**Why this breaks:** ${reasons[0]}\n`;
                        }
                        
                        formatted += `**Fix:** ${finding.suggested_fix || 'Review changes in the diff above and fix the issue'}\n\n`;
                    });
                }
            } else {
                formatted += `## STATUS\n`;
                formatted += `No urgent bugs detected. Safe to deploy.\n\n`;
            }
            
            formatted += `---\n`;
            formatted += `Commit: ${commitShort}\n`;
            formatted += `Use the diff above to understand what changed, then fix the bugs listed.\n`;
            
            return formatted;
        }

        function copyDebugBundle() {
            const content = document.getElementById('debugBundleContent').textContent;
            navigator.clipboard.writeText(content).then(() => {
                const btn = document.getElementById('copyBundleBtn');
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        function showAgentInfo(agentName, description) {
            const overlay = document.getElementById('agentInfoModalOverlay');
            const title = document.getElementById('agentInfoModalTitle');
            const body = document.getElementById('agentInfoModalBody');
            
            // Set title
            title.textContent = agentName;
            
            // Simple 2-line format - split by double newline
            const lines = description.split(/\n\n+/).filter(s => s.trim());
            let htmlContent = '';
            
            lines.forEach((line, index) => {
                if (line.trim()) {
                    htmlContent += `<p style="margin-bottom: ${index < lines.length - 1 ? '0.75rem' : '0'}; line-height: 1.6;">${line.trim()}</p>`;
                }
            });
            
            body.innerHTML = htmlContent || `<p>${description}</p>`;
            
            // Show modal - ensure it's centered
            overlay.classList.add('show');
            
            // Prevent body scroll when modal is open
            document.body.style.overflow = 'hidden';
            
            // Close on Escape key
            const escapeHandler = (e) => {
                if (e.key === 'Escape') {
                    hideAgentInfo();
                    document.removeEventListener('keydown', escapeHandler);
                }
            };
            document.addEventListener('keydown', escapeHandler);
        }
        
        function hideAgentInfo() {
            const overlay = document.getElementById('agentInfoModalOverlay');
            overlay.classList.remove('show');
            document.body.style.overflow = '';
        }
        
        function showError(message) {
            const errorSection = document.getElementById('errorSection');
            
            let errorMessage = message;
            if (message.includes('GitHub URL')) {
                errorMessage = `
                    <strong>GitHub URL Detected:</strong><br>
                    It looks like you entered a GitHub URL. Select "GitHub Repository" from the "Source Type" dropdown, or enter a local file path.
                `;
            } else if (message.includes('Repository path not found')) {
                errorMessage = `
                    <strong>Repository Not Found:</strong><br>
                    ${message}<br>
                    If this is a GitHub repository, select "GitHub Repository" as the source type.
                `;
            }
            
            errorSection.innerHTML = errorMessage;
            errorSection.classList.add('show');
            document.getElementById('analyzeBtn').disabled = false;
            document.getElementById('loadingOverlay').classList.remove('show');
            
            errorSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    </script>
</body>
</html>
